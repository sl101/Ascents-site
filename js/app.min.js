'use strict';

// Spollers ==========================================
const accordeonButtons = document.getElementsByClassName("faq__button");

for(var i = 0; i < accordeonButtons.length; i++) {
    var accordeonButton = accordeonButtons[i];
    accordeonButton.addEventListener("click", toggleItems, false);
}

function toggleItems() {
    var itemClass = this.className;
    for(var i = 0; i < accordeonButtons.length; i++) {
        accordeonButtons[i].className = "faq__button closed";
    }
    var pannels = document.getElementsByClassName("faq__text");
    for (var z = 0; z < pannels.length; z++) {
        pannels[z].style.maxHeight = 0;
    }
    if(itemClass == "faq__button closed") {
        this.className = "faq__button _active";
        var panel = this.nextElementSibling;
        panel.style.maxHeight = panel.scrollHeight + "px";
    }else {
		}
}

// Burger =============================================
const burger = document.querySelector('.burger');
const menu_ = document.querySelector('.menu');
const fixedBlocks = document.querySelectorAll('._fixed');
const header = document.querySelector('.header');

if (burger) {
	burger.addEventListener("click", function (e) {
		let paddingOffset_ = window.innerWidth  - document.body.offsetWidth + 'px';
		if (document.body.classList.contains('_lock')){
			burger_close();
		} else {
			burger_open(paddingOffset_);
		}
	});
};

function burger_open(element){
	fixedBlocks.forEach((el) => {
		el.style.paddingRight = element;
	});
	document.body.style.paddingRight = element;
	document.body.classList.add("_lock");
	burger.classList.add("_active");
	menu_.classList.add("_active");
}

function burger_close(){
	fixedBlocks.forEach((el) => {
		el.style.paddingRight = '0';
	});
	document.body.style.paddingRight = '0';
	document.body.classList.remove("_lock");
	burger.classList.remove("_active");
	menu_.classList.remove("_active");
}


// subscribe, connect ====================================
let subscribeButton = document.querySelector('.footer__form--btn');
let removeInput = document.querySelector('.footer__input');
let send = document.querySelector('.form-connect__btn');
let connectName = document.querySelector('.form-connect__input--name');
let connectPhone = document.querySelector('.form-connect__input--tel');
let connectEmail = document.querySelector('.form-connect__input--mail');
let request = document.querySelector('.form-request__btn');
let requestName = document.querySelector('.form-request__input--name');
let requestPhone = document.querySelector('.form-request__input--tel');
let requestEmail = document.querySelector('.form-request__input--mail');
let dataBtn = document.querySelector('.form-data__btn');
let dataName = document.querySelector('.form-data__input--name');
let dataPhone = document.querySelector('.form-data__input--tel');
let langValue = document.getElementsByTagName("html")[0].getAttribute("lang");


if(subscribeButton){
	subscribeButton.onclick = function(evt) {
		evt.preventDefault();
	if(removeInput.value.indexOf("@")<1 || removeInput.value.indexOf(".")<1){
		if(langValue == "ru"){
			subscribeButton.textContent = 'e-mail введен не верно';
		}else{
			subscribeButton.textContent = 'e-mail entered incorrectly';
		}
}else{
	subscribeButton.classList.add('_active');
	if(langValue == "ru"){
		subscribeButton.textContent = 'Вы подписались на рассылку';
	}else{
		subscribeButton.textContent = 'You have subscribed to the newsletter';
	}
} 
	};
}

send.onclick = function(evt) {
	evt.preventDefault();
	if(connectName.value.length >= 1){
		if(connectPhone.value.length >= 9){
				if(connectEmail.value.includes('@') && connectEmail.value.includes('.')){
			send.classList.add('_active');
			if(langValue == "ru"){
				send.textContent = 'Отправлено';
			}else{
				send.textContent = 'Sent by';
			}
		}else{
			if(langValue == "ru"){
				send.textContent = 'Введите e-mail';
			}else{
				send.textContent = 'Enter your e-mail';
			}
		}
	}else{
		if(langValue == "ru"){
			send.textContent = 'Введите телефон';
		}else{
			send.textContent = 'Enter your phone number';
		}
	}
}else{
	if(langValue == "ru"){
		send.textContent = 'Введите имя';
	}else{
		send.textContent = 'Enter your name';
	}
	}
};

connectName.onclick = function(evt) {
	if(send.classList.contains('_active')) {
		send.classList.remove('_active');
		connectName.value = '';
		connectPhone.value = '';
		connectEmail.value = '';
	}
	if(langValue == "ru"){
		send.textContent = 'Отправить';
	}else{
		send.textContent = 'Send';
	}
};

request.onclick = function(ev) {
	ev.preventDefault();
	if(requestName.value.length >= 1){
		if(requestPhone.value.length >= 9){
				if(requestEmail.value.includes('@') && requestEmail.value.includes('.')){
			request.classList.add('_active');
			if(langValue == "ru"){
				request.textContent = 'Отправлено';
			}else{
				request.textContent = 'Sent by';
			}
		}else{
			if(langValue == "ru"){
				request.textContent = 'Введите e-mail';
			}else{
				request.textContent = 'Enter your e-mail';
			}
		}
	}else{
		if(langValue == "ru"){
			request.textContent = 'Введите телефон';
		}else{
			request.textContent = 'Enter your phone number';
		}
	}
}else{
	if(langValue == "ru"){
		request.textContent = 'Введите имя';
	}else{
		request.textContent = 'Enter your name';
	}
	}
};

requestName.onclick = function(evt) {
	if(request.classList.contains('_active')) {
		request.classList.remove('_active');
		requestName.value = '';
		requestPhone.value = '';
		requestEmail.value = '';
	}
	if(langValue == "ru"){
		request.textContent = 'Отправить';
	}else{
		request.textContent = 'Send';
	}
};

dataBtn.onclick = function(e) {
	e.preventDefault();
	if(dataName.value.length >= 1){
		if(dataPhone.value.length >= 9){
			dataBtn.classList.add('_active');
			if(langValue == "ru"){
				dataBtn.textContent = 'Отправлено';
			}else{
				dataBtn.textContent = 'Sent by';
			}
	}else{
		if(langValue == "ru"){
			dataBtn.textContent = 'Введите телефон';
		}else{
			dataBtn.textContent = 'Enter your phone number';
		}
	}
}else{
	if(langValue == "ru"){
		dataBtn.textContent = 'Введите имя';
	}else{
		dataBtn.textContent = 'Enter your name';
	}
	}
};

dataName.onclick = function(evt) {
	if(dataBtn.classList.contains('_active')) {
		dataBtn.classList.remove('_active');
		dataName.value = '';
		dataPhone.value = '';
	}
	if(langValue == "ru"){
		dataBtn.textContent = 'Отправить';
	}else{
		dataBtn.textContent = 'Send';
	}
};

// checkbox ====================================
let label = document.querySelector('.footer__check');
let footerCheckbox = document.querySelector('.footer__checkbox');

label.onclick = function() {
	if(!footerCheckbox.checked){
		label.classList.add('_active');
	}else{
		label.classList.remove('_active');
	}
};

// number animation ====================================
let parentNubers = document.querySelector('.reviews__top');
let animNumbers = document.querySelectorAll('.reviews__result');

let blockAnimate = true;
const window_height = window.innerHeight;  // высота окна браузера
const animElements = document.querySelectorAll('.anim-item');

if(animElements.length > 0){
	
	window.addEventListener('scroll', animOnScroll); // ставим слушатель на окно

	function animOnScroll (param){ 
		for(let i = 0; i < animElements.length; i++) {
			
			let animItem = animElements[i];
			let animItemHeight = animItem.offsetHeight; // высота елемента
			let animItemOffset = offset(animItem).top; // расстояние от верха элемента до начала страницы
			let animStart = 1; // коэфициент 
			
			let animItemPoint = (window_height - animItemHeight / animStart); // часть элемета при появлениии которой запускается анимация
			
			if(animItemHeight > window_height){
				animItemPoint = window_height - window_height / animStart; // часть элемета при появлениии которой запускается анимация, если элемент больше окна
			}
			if((pageYOffset > animItemOffset - animItemPoint) && pageYOffset < (animItemOffset + animItemHeight)){
					animItem.classList.add('_animate');
			} else {
				if(!animItem.classList.contains('_anim-no-hide')){ 
					animItem.classList.remove('_animate');
				}
			}
		}
	}

	function offset(el) {
		const rect = el.getBoundingClientRect(),
		scrollLeft = window.pageXOffset || document.documentElement.scrollLeft,
		scrollTop = window.pageYOffset || document.documentElement.scrollTop;
		return {top: rect.top + scrollTop, left: rect.left + scrollLeft};
	}

	setTimeout(() => {
		animOnScroll();
	},300);
};





// ===============================================
var ua = window.navigator.userAgent;
var msie = ua.indexOf("MSIE ");
var isMobile = { Android: function () { return navigator.userAgent.match(/Android/i); }, BlackBerry: function () { return navigator.userAgent.match(/BlackBerry/i); }, iOS: function () { return navigator.userAgent.match(/iPhone|iPad|iPod/i); }, Opera: function () { return navigator.userAgent.match(/Opera Mini/i); }, Windows: function () { return navigator.userAgent.match(/IEMobile/i); }, any: function () { return (isMobile.Android() || isMobile.BlackBerry() || isMobile.iOS() || isMobile.Opera() || isMobile.Windows()); } };
function isIE() {
	ua = navigator.userAgent;
	var is_ie = ua.indexOf("MSIE ") > -1 || ua.indexOf("Trident/") > -1;
	return is_ie;
}
if (isIE()) {
	document.querySelector('html').classList.add('ie');
}
if (isMobile.any()) {
	document.querySelector('html').classList.add('_touch');
}

// =========================================
function testWebP(callback) {
	var webP = new Image();
	webP.onload = webP.onerror = function () {
		callback(webP.height == 2);
	};
	webP.src = "data:image/webp;base64,UklGRjoAAABXRUJQVlA4IC4AAACyAgCdASoCAAIALmk0mk0iIiIiIgBoSygABc6WWgAA/veff/0PP8bA//LwYAAA";
}
testWebP(function (support) {
	if (support === true) {
		document.querySelector('html').classList.add('_webp');
	} else {
		document.querySelector('html').classList.add('_no-webp');
	}
});

// ========================================================
function ibg() {
	if (isIE()) {
		let ibg = document.querySelectorAll("._ibg");
		for (var i = 0; i < ibg.length; i++) {
			if (ibg[i].querySelector('img') && ibg[i].querySelector('img').getAttribute('src') != null) {
				ibg[i].style.backgroundImage = 'url(' + ibg[i].querySelector('img').getAttribute('src') + ')';
			}
		}
	}
}
ibg();

window.addEventListener("load", function () {
	if (document.querySelector('.wrapper')) {
		setTimeout(function () {
			document.querySelector('.wrapper').classList.add('_loaded');
		}, 0);
	}
});

function email_test(input) {
	return !/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,8})+$/.test(input.value);
}

//let btn = document.querySelectorAll('button[type="submit"],input[type="submit"]');
let forms = document.querySelectorAll('form');
if (forms.length > 0) {
	for (let index = 0; index < forms.length; index++) {
		const el = forms[index];
		el.addEventListener('submit', form_submit);
	}
}
async function form_submit(e) {
	let btn = e.target;
	let form = btn.closest('form');
	let error = form_validate(form);
	if (error == 0) {
		let formAction = form.getAttribute('action') ? form.getAttribute('action').trim() : '#';
		let formMethod = form.getAttribute('method') ? form.getAttribute('method').trim() : 'GET';
		const message = form.getAttribute('data-message');
		const ajax = form.getAttribute('data-ajax');

		//SendForm
		if (ajax) {
			e.preventDefault();
			let formData = new FormData(form);
			form.classList.add('_sending');
			let response = await fetch(formAction, {
				method: formMethod,
				body: formData
			});
			if (response.ok) {
				let result = await response.json();
				form.classList.remove('_sending');
				if (message) {
					popup_open(message + '-message');
				}
				form_clean(form);
			} else {
				alert("Ошибка");
				form.classList.remove('_sending');
			}
		}
		// If test
		if (form.hasAttribute('data-test')) {
			e.preventDefault();
			if (message) {
				popup_open(message + '-message');
			}
			form_clean(form);
		}
	} else {
		let form_error = form.querySelectorAll('._error');
		if (form_error && form.classList.contains('_goto-error')) {
			_goto(form_error[0], 1000, 50);
		}
		e.preventDefault();
	}
}
function form_validate(form) {
	let error = 0;
	let form_req = form.querySelectorAll('._req');
	if (form_req.length > 0) {
		for (let index = 0; index < form_req.length; index++) {
			const el = form_req[index];
			if (!_is_hidden(el)) {
				error += form_validate_input(el);
			}
		}
	}
	return error;
}
function form_validate_input(input) {
	let error = 0;
	let input_g_value = input.getAttribute('data-value');

	if (input.getAttribute("name") == "email" || input.classList.contains("_email")) {
		if (input.value != input_g_value) {
			let em = input.value.replace(" ", "");
			input.value = em;
		}
		if (email_test(input) || input.value == input_g_value) {
			form_add_error(input);
			error++;
		} else {
			form_remove_error(input);
		}
	} else if (input.getAttribute("type") == "checkbox" && input.checked == false) {
		form_add_error(input);
		error++;
	} else {
		if (input.value == '' || input.value == input_g_value) {
			form_add_error(input);
			error++;
		} else {
			form_remove_error(input);
		}
	}
	return error;
}
function form_add_error(input) {
	input.classList.add('_error');
	input.parentElement.classList.add('_error');

	let input_error = input.parentElement.querySelector('.form__error');
	if (input_error) {
		input.parentElement.removeChild(input_error);
	}
	let input_error_text = input.getAttribute('data-error');
	if (input_error_text && input_error_text != '') {
		input.parentElement.insertAdjacentHTML('beforeend', '<div class="form__error">' + input_error_text + '</div>');
	}
}
function form_remove_error(input) {
	input.classList.remove('_error');
	input.parentElement.classList.remove('_error');

	let input_error = input.parentElement.querySelector('.form__error');
	if (input_error) {
		input.parentElement.removeChild(input_error);
	}
}
function form_clean(form) {
	let inputs = form.querySelectorAll('input,textarea');
	for (let index = 0; index < inputs.length; index++) {
		const el = inputs[index];
		el.parentElement.classList.remove('_focus');
		el.classList.remove('_focus');
		el.value = el.getAttribute('data-value');
	}
	let checkboxes = form.querySelectorAll('.checkbox__input');
	if (checkboxes.length > 0) {
		for (let index = 0; index < checkboxes.length; index++) {
			const checkbox = checkboxes[index];
			checkbox.checked = false;
		}
	}
	let selects = form.querySelectorAll('select');
	if (selects.length > 0) {
		for (let index = 0; index < selects.length; index++) {
			const select = selects[index];
			const select_default_value = select.getAttribute('data-default');
			select.value = select_default_value;
			select_item(select);
		}
	}
}

//viewPass
let viewPass = document.querySelectorAll('._viewpass');
for (let index = 0; index < viewPass.length; index++) {
	const element = viewPass[index];
	element.addEventListener("click", function (e) {
		if (element.classList.contains('_active')) {
			element.parentElement.querySelector('input').setAttribute("type", "password");
		} else {
			element.parentElement.querySelector('input').setAttribute("type", "text");
		}
		element.classList.toggle('_active');
	});
}

//Select
let selects = document.getElementsByTagName('select');
if (selects.length > 0) {
	selects_init();
}
function selects_init() {
	for (let index = 0; index < selects.length; index++) {
		const select = selects[index];
		select_init(select);
	}
	//select_callback();
	document.addEventListener('click', function (e) {
		selects_close(e);
	});
	document.addEventListener('keydown', function (e) {
		if (e.code === 'Escape') {
			selects_close(e);
		}
	});
}
function selects_close(e) {
	const selects = document.querySelectorAll('.select');
	if (!e.target.closest('.select') && !e.target.classList.contains('_option')) {
		for (let index = 0; index < selects.length; index++) {
			const select = selects[index];
			const select_body_options = select.querySelector('.select__options');
			select.classList.remove('_active');
			_slideUp(select_body_options, 100);
		}
	}
}
function select_init(select) {
	const select_parent = select.parentElement;
	const select_modifikator = select.getAttribute('class');
	const select_selected_option = select.querySelector('option:checked');
	select.setAttribute('data-default', select_selected_option.value);
	select.style.display = 'none';

	select_parent.insertAdjacentHTML('beforeend', '<div class="select select_' + select_modifikator + '"></div>');

	let new_select = select.parentElement.querySelector('.select');
	new_select.appendChild(select);
	select_item(select);
}
function select_item(select) {
	const select_parent = select.parentElement;
	const select_items = select_parent.querySelector('.select__item');
	const select_options = select.querySelectorAll('option');
	const select_selected_option = select.querySelector('option:checked');
	const select_selected_text = select_selected_option.text;
	const select_type = select.getAttribute('data-type');

	if (select_items) {
		select_items.remove();
	}

	let select_type_content = '';
	if (select_type == 'input') {
		select_type_content = '<div class="select__value icon-select-arrow"><input autocomplete="off" type="text" name="form[]" value="' + select_selected_text + '" data-error="Ошибка" data-value="' + select_selected_text + '" class="select__input"></div>';
	} else {
		select_type_content = '<div class="select__value icon-select-arrow"><span>' + select_selected_text + '</span></div>';
	}

	select_parent.insertAdjacentHTML('beforeend',
		'<div class="select__item">' +
		'<div class="select__title">' + select_type_content + '</div>' +
		'<div hidden class="select__options">' + select_get_options(select_options) + '</div>' +
		'</div></div>');

	select_actions(select, select_parent);
}
function select_actions(original, select) {
	const select_item = select.querySelector('.select__item');
	const selectTitle = select.querySelector('.select__title');
	const select_body_options = select.querySelector('.select__options');
	const select_options = select.querySelectorAll('.select__option');
	const select_type = original.getAttribute('data-type');
	const select_input = select.querySelector('.select__input');

	selectTitle.addEventListener('click', function (e) {
		selectItemActions();
	});

	function selectMultiItems() {
		let selectedOptions = select.querySelectorAll('.select__option');
		let originalOptions = original.querySelectorAll('option');
		let selectedOptionsText = [];
		for (let index = 0; index < selectedOptions.length; index++) {
			const selectedOption = selectedOptions[index];
			originalOptions[index].removeAttribute('selected');
			if (selectedOption.classList.contains('_selected')) {
				const selectOptionText = selectedOption.innerHTML;
				selectedOptionsText.push(selectOptionText);
				originalOptions[index].setAttribute('selected', 'selected');
			}
		}
		select.querySelector('.select__value').innerHTML = '<span>' + selectedOptionsText + '</span>';
	}
	function selectItemActions(type) {
		if (!type) {
			let selects = document.querySelectorAll('.select');
			for (let index = 0; index < selects.length; index++) {
				const select = selects[index];
				const select_body_options = select.querySelector('.select__options');
				if (select != select_item.closest('.select')) {
					select.classList.remove('_active');
					_slideUp(select_body_options, 100);
				}
			}
			_slideToggle(select_body_options, 100);
			select.classList.toggle('_active');
		}
	}
	for (let index = 0; index < select_options.length; index++) {
		const select_option = select_options[index];
		const select_option_value = select_option.getAttribute('data-value');
		const select_option_text = select_option.innerHTML;

		if (select_type == 'input') {
			select_input.addEventListener('keyup', select_search);
		} else {
			if (select_option.getAttribute('data-value') == original.value && !original.hasAttribute('multiple')) {
				select_option.style.display = 'none';
			}
		}
		select_option.addEventListener('click', function () {
			for (let index = 0; index < select_options.length; index++) {
				const el = select_options[index];
				el.style.display = 'block';
			}
			if (select_type == 'input') {
				select_input.value = select_option_text;
				original.value = select_option_value;
			} else {
				if (original.hasAttribute('multiple')) {
					select_option.classList.toggle('_selected');
					selectMultiItems();
				} else {
					select.querySelector('.select__value').innerHTML = '<span>' + select_option_text + '</span>';
					original.value = select_option_value;
					select_option.style.display = 'none';
				}
			}
			let type;
			if (original.hasAttribute('multiple')) {
				type = 'multiple';
			}
			selectItemActions(type);
		});
	}
}
function select_get_options(select_options) {
	if (select_options) {
		let select_options_content = '';
		for (let index = 0; index < select_options.length; index++) {
			const select_option = select_options[index];
			const select_option_value = select_option.value;
			if (select_option_value != '') {
				const select_option_text = select_option.innerHTML;
				select_options_content = select_options_content + '<div data-value="' + select_option_value + '" class="select__option">' + select_option_text + '</div>';
			}
		}
		return select_options_content;
	}
}
function select_search(e) {
	let select_block = e.target.closest('.select ').querySelector('.select__options');
	let select_options = e.target.closest('.select ').querySelectorAll('.select__option');
	let select_search_text = e.target.value.toUpperCase();

	for (let i = 0; i < select_options.length; i++) {
		let select_option = select_options[i];
		let select_txt_value = select_option.textContent || select_option.innerText;
		if (select_txt_value.toUpperCase().indexOf(select_search_text) > -1) {
			select_option.style.display = "";
		} else {
			select_option.style.display = "none";
		}
	}
}
function selects_update_all() {
	let selects = document.querySelectorAll('select');
	if (selects) {
		for (let index = 0; index < selects.length; index++) {
			const select = selects[index];
			select_item(select);
		}
	}
}

//Placeholers
let inputs = document.querySelectorAll('input[data-value],textarea[data-value]');
inputs_init(inputs);

function inputs_init(inputs) {
	if (inputs.length > 0) {
		for (let index = 0; index < inputs.length; index++) {
			const input = inputs[index];
			const input_g_value = input.getAttribute('data-value');
			input_placeholder_add(input);
			if (input.value != '' && input.value != input_g_value) {
				input_focus_add(input);
			}
			input.addEventListener('focus', function (e) {
				if (input.value == input_g_value) {
					input_focus_add(input);
					input.value = '';
				}
				if (input.getAttribute('data-type') === "pass") {
					if (input.parentElement.querySelector('._viewpass')) {
						if (!input.parentElement.querySelector('._viewpass').classList.contains('_active')) {
							input.setAttribute('type', 'password');
						}
					} else {
						input.setAttribute('type', 'password');
					}
				}
				if (input.classList.contains('_date')) {
					/*
					input.classList.add('_mask');
					Inputmask("99.99.9999", {
						//"placeholder": '',
						clearIncomplete: true,
						clearMaskOnLostFocus: true,
						onincomplete: function () {
							input_clear_mask(input, input_g_value);
						}
					}).mask(input);
					*/
				}
				if (input.classList.contains('_phone')) {
					// '+7(999) 999 9999'
					//'+38(999) 999 9999'
					//'+375(99)999-99-99'
					input.classList.add('_mask');
					// Inputmask("+375 (99) 9999999", {
					Inputmask("+7(999) 999 9999", {
						//"placeholder": '',
						clearIncomplete: true,
						clearMaskOnLostFocus: true,
						onincomplete: function () {
							input_clear_mask(input, input_g_value);
						}
					}).mask(input);
				}
				if (input.classList.contains('_digital')) {
					input.classList.add('_mask');
					Inputmask("9{1,}", {
						"placeholder": '',
						clearIncomplete: true,
						clearMaskOnLostFocus: true,
						onincomplete: function () {
							input_clear_mask(input, input_g_value);
						}
					}).mask(input);
				}
				form_remove_error(input);
			});
			input.addEventListener('blur', function (e) {
				if (input.value == '') {
					input.value = input_g_value;
					input_focus_remove(input);
					if (input.classList.contains('_mask')) {
						input_clear_mask(input, input_g_value);
					}
					if (input.getAttribute('data-type') === "pass") {
						input.setAttribute('type', 'text');
					}
				}
			});
			if (input.classList.contains('_date')) {
				const calendarItem = datepicker(input, {
					customDays: ["Пн", "Вт", "Ср", "Чт", "Пт", "Сб", "Вс"],
					customMonths: ["Янв", "Фев", "Мар", "Апр", "Май", "Июн", "Июл", "Авг", "Сен", "Окт", "Ноя", "Дек"],
					overlayButton: 'Применить',
					overlayPlaceholder: 'Год (4 цифры)',
					startDay: 1,
					formatter: (input, date, instance) => {
						const value = date.toLocaleDateString()
						input.value = value
					},
					onSelect: function (input, instance, date) {
						input_focus_add(input.el);
					}
				});
				const dataFrom = input.getAttribute('data-from');
				const dataTo = input.getAttribute('data-to');
				if (dataFrom) {
					calendarItem.setMin(new Date(dataFrom));
				}
				if (dataTo) {
					calendarItem.setMax(new Date(dataTo));
				}
			}
		}
	}
}
function input_placeholder_add(input) {
	const input_g_value = input.getAttribute('data-value');
	if (input.value == '' && input_g_value != '') {
		input.value = input_g_value;
	}
}
function input_focus_add(input) {
	input.classList.add('_focus');
	input.parentElement.classList.add('_focus');
}
function input_focus_remove(input) {
	input.classList.remove('_focus');
	input.parentElement.classList.remove('_focus');
}
function input_clear_mask(input, input_g_value) {
	input.inputmask.remove();
	input.value = input_g_value;
	input_focus_remove(input);
}

//QUANTITY
let quantityButtons = document.querySelectorAll('.quantity__button');
if (quantityButtons.length > 0) {
	for (let index = 0; index < quantityButtons.length; index++) {
		const quantityButton = quantityButtons[index];
		quantityButton.addEventListener("click", function (e) {
			let value = parseInt(quantityButton.closest('.quantity').querySelector('input').value);
			if (quantityButton.classList.contains('quantity__button_plus')) {
				value++;
			} else {
				value = value - 1;
				if (value < 1) {
					value = 1
				}
			}
			quantityButton.closest('.quantity').querySelector('input').value = value;
		});
	}
}

//RANGE
const priceSlider = document.querySelector('.price-filter__slider');
if (priceSlider) {

	let textFrom = priceSlider.getAttribute('data-from');
	let textTo = priceSlider.getAttribute('data-to');

	noUiSlider.create(priceSlider, {
		start: [0, 200000],
		connect: true,
		tooltips: [wNumb({ decimals: 0, prefix: textFrom + ' ' }), wNumb({ decimals: 0, prefix: textTo + ' ' })],
		range: {
			'min': [0],
			'max': [200000]
		}
	});

	/*
	const priceStart = document.getElementById('price-start');
	const priceEnd = document.getElementById('price-end');
	priceStart.addEventListener('change', setPriceValues);
	priceEnd.addEventListener('change', setPriceValues);
	*/

	function setPriceValues() {
		let priceStartValue;
		let priceEndValue;
		if (priceStart.value != '') {
			priceStartValue = priceStart.value;
		}
		if (priceEnd.value != '') {
			priceEndValue = priceEnd.value;
		}
		priceSlider.noUiSlider.set([priceStartValue, priceEndValue]);
	}
}
	// Swipers ============================================
	let mySlider = new Swiper('.slider', {

		wrapperClass: 'slider__wrapper',
		slideClass: 'slider__slide',

		slidesPerView: 1,
		speed: 900,
		grabCursor: true,
		touchAngel: 45,
		toucRatio: 1,
		initialSlide: 0,
		autoplay: true,

		scrollbar: {
			el: '.swiper-scrollbar',
			draggable: true,
			dragSize: 50,
		},

		pagination: {
			el: '.slider__pagination',
			clickable: true,
			type: 'fraction',
		},

		effect: "fade",
		fadeEffect: {
			crossFade: true,
		},

		keyboard: {
			enabled: true,
			onlyInViewport: false,
			pageUpDown: true,
		},

		breakpoints: {
			768: {
				direction: 'vertical',
			}
		}
	});

	let cardSwiper = new Swiper('.itineraries-swiper', {

		slideClass: 'itineraries-swiper__slide',
		wrapperClass: 'itineraries-swiper__wrapper',

		initialSlide: 1,
		spaceBetween: 10,
		slidesPerView: 1.05,
		paginationClickable: true,

		pagination: {
			el: '.itineraries-pagination',
			clickable: true,
			type: 'bullets',
		},
		

		breakpoints: {
			320: {
				slidesPerView: 1.25,
				spaceBetween: 15,
			},
			767.98: {
				spaceBetween: 25,
				slidesPerView: 1.74,
			},
			991.98: {
				slidesPerView: 2.26,
				spaceBetween: 20,
			},
			1337: {
				slidesPerView: 3,
				watchOverflow: true,
			}
		}
	});

	let reviewsSwiper = new Swiper('.swiper-reviews', {

		wrapperClass: 'swiper-reviews__wrapper',
		slideClass: 'swiper-reviews__slide',

		slidesPerView: 1,
		initialSlide: 0,
		speed: 900,
		loop: true,

		pagination: {
			el: '.swiper-reviews__pagination',
			clickable: true,
			type: 'bullets',
		},

		navigation: {
			prevEl: '.swiper-reviews__arrow--prev',
			nextEl: '.swiper-reviews__arrow--next',
		},


		keyboard: {
			enabled: true,
			onlyInViewport: true,
		}
	});
// scroll to hover =====================================
const decorItems = document.querySelectorAll('.advantages__box');
let windowTop = window.pageYOffset;

headerScroll();

const decorAnimation = () => {
			if(decorItems.length > 0){
		for(var i = 0; i < decorItems.length; i++) {
			const decorItem = decorItems[i];
			const decorItemHeight = decorItem.offsetHeight;
			const decorItemOffset = offset(decorItem).top; 
			const decorStart = decorItemOffset - (window_height/2+decorItemHeight); 

				if(pageYOffset > decorStart && pageYOffset < (decorStart + decorItemHeight*3)){
					decorItem.classList.add('animation');
			} else {
					decorItem.classList.remove('animation');
				}
		};
	};
};

function offset(el) {
	const rect = el.getBoundingClientRect(),
	scrollLeft = window.pageXOffset || document.documentElement.scrollLeft,
	scrollTop = window.pageYOffset || document.documentElement.scrollTop;
	return {top: rect.top + scrollTop, left: rect.left + scrollLeft};
}

window.addEventListener ('scroll', () => {
	decorAnimation();
	// scroll had ===========================================
	headerScroll();
});

function headerScroll(){
		windowTop = window.pageYOffset;
	if(windowTop> 300){
		header.classList.add('sticky-vh');
	}else if(windowTop > 100){
		header.classList.add('sticky');
		header.classList.remove('sticky-vh');
	}else{
		header.classList.remove('sticky');
	} 
}

// ScrollOnClick =================================
const menuLinks = document.querySelectorAll('._goto[data-goto]');
if(menuLinks.length > 0){
	menuLinks.forEach(menuLink => {
		menuLink.addEventListener("click", onMenuLinkClick);
	});

	function onMenuLinkClick(e) {
		e.preventDefault();
		const menuLink = e.target;
			if(menuLink.dataset.goto && document.querySelector(menuLink.dataset.goto)) {
				const gotoBlock = document.querySelector(menuLink.dataset.goto);
				const gotoBlockValue = gotoBlock.getBoundingClientRect().top + pageYOffset - document.querySelector('header').offsetHeight;

				if(burger.classList.contains('_active')){
					burger_close(); 
				}

				window.scrollTo({
					top: gotoBlockValue,
					behavior: "smooth"
				});
			}
	}
}

const popupLinks = document.querySelectorAll('.popup-link');
const body = document.querySelector('body');
const lockPadding = document.querySelectorAll(".lock-padding");

let unlock = true;

const timeout = 800;

if (popupLinks.length > 0) {
	for (let index = 0; index < popupLinks.length; index++) {
		const popupLink = popupLinks[index];
		popupLink.addEventListener("click", function (e) {
			const popupName = popupLink.getAttribute('href').replace('#', '');
			const curentPopup = document.getElementById(popupName);
			popupOpen(curentPopup);
			e.preventDefault();
		});
	}
}
const popupCloseIcon = document.querySelectorAll('.close-popup');
if (popupCloseIcon.length > 0) {
	for (let index = 0; index < popupCloseIcon.length; index++) {
		const el = popupCloseIcon[index];
		el.addEventListener('click', function (e) {
			popupClose(el.closest('.popup'));
			e.preventDefault();
		});
	}
}

function popupOpen(curentPopup) {
	if (curentPopup && unlock) {
		const popupActive = document.querySelector('.popup.open');
		if (popupActive) {
			popupClose(popupActive, false);
		} else {
			bodyLock();
		}
		curentPopup.classList.add('open'); 
		curentPopup.addEventListener("click", function (e) {
			if (!e.target.closest('.popup__body')) {
				popupClose(e.target.closest('.popup'));
			}
		});
	}
}

function popupClose(popupActive, dounlock = true) {
	if (unlock) {
		popupActive.classList.remove('open');
		if (dounlock) {
			bodyunlock();
		}
	}
}

function bodyLock() {
	const lockPaddingValue = window.innerWidth - document.querySelector('.body').offsetWidth + 'px';
	
	if (lockPadding.length > 0) {
		for (let index = 0; index < lockPadding.length; index++) {
			const el = lockPadding[index];
			el.style.paddingRight = lockPaddingValue;
		}
	}
	body.style.paddingRight = lockPaddingValue;
	body.classList.add('_lock');

	unlock = false;
	setTimeout(function () {
		unlock = true;
	}, timeout);
}

function bodyunlock() {
	setTimeout(function () {
		if (lockPadding.length > 0) {
			for (let index = 0; index < lockPadding.length; index++) {
				const el = lockPadding[index];
				el.style.paddingRight = '0px';
			}
		}
		body.style.paddingRight = '0px';
		body.classList.remove('_lock');
	}, timeout);

	unlock = false;
	setTimeout(function () {
		unlock = true;
	}, timeout);
}

document.addEventListener('keydown', function (e) {
	if (e.which === 27) {
		const popupActive = document.querySelector('.popup.open');
		popupClose(popupActive);
	}
});

(function () {
	// проверяем поддержку
	if (!Element.prototype.closest) {
		// реализуем
		Element.prototype.closest = function (css) {
			var node = this;
			while (node) {
				if (node.matches(css)) return node;
				else node = node.parentElement;
			}
			return null;
		};
	}
})();
(function () {
	// проверяем поддержку
	if (!Element.prototype.matches) {
		// определяем свойство
		Element.prototype.matches = Element.prototype.matchesSelector ||
			Element.prototype.webkitMatchesSelector ||
			Element.prototype.mozMatchesSelector ||
			Element.prototype.msMatchesSelector;
	}
})();
